# ğŸ“ Architecture Diagrams - SamaConso API Production

**Diagrammes et schÃ©mas de l'infrastructure production**

---

## ğŸ—ï¸ Vue d'Ensemble Haute Niveau

```
                          INTERNET / VPN
                               â”‚
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FIREWALL       â”‚
                    â”‚   Senelec        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  LOAD BALANCER   â”‚
                    â”‚      F5          â”‚
                    â”‚  (10.101.X.X0)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
          â†“                  â†“                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚SERVEUR 1 â”‚       â”‚SERVEUR 2 â”‚      â”‚SERVEUR 3 â”‚
    â”‚  (DB &   â”‚       â”‚  (API &  â”‚      â”‚(Workers &â”‚
    â”‚ Storage) â”‚       â”‚ Broker)  â”‚      â”‚  Cache)  â”‚
    â”‚10.101.X.X1â”‚      â”‚10.101.X.X2â”‚     â”‚10.101.X.X3â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ SERVEUR 1: Base de DonnÃ©es & Stockage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR 1                            â”‚
â”‚                 Ubuntu 22.04 LTS                        â”‚
â”‚                 IP: 10.101.X.X1                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PostgreSQL 15  (Port 5432)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Database: samaconso                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Users table                       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Sessions table                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Notifications table               â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Consumption data                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Max connections: 200                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  shared_buffers: 2GB                 â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PgBouncer  (Port 6432)                        â”‚   â”‚
â”‚  â”‚  â€¢ Pool mode: transaction                      â”‚   â”‚
â”‚  â”‚  â€¢ Max client conn: 10,000                     â”‚   â”‚
â”‚  â”‚  â€¢ Default pool size: 100                      â”‚   â”‚
â”‚  â”‚  â€¢ Timeout: 120s                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MinIO  (Ports 9000, 9001)                     â”‚   â”‚
â”‚  â”‚  â€¢ Stockage S3-compatible                      â”‚   â”‚
â”‚  â”‚  â€¢ Buckets:                                    â”‚   â”‚
â”‚  â”‚    - avatars                                   â”‚   â”‚
â”‚  â”‚    - documents                                 â”‚   â”‚
â”‚  â”‚    - uploads                                   â”‚   â”‚
â”‚  â”‚  â€¢ Volume: /data/minio                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Backup automatique (Cron)                     â”‚   â”‚
â”‚  â”‚  â€¢ Daily: 02:00                                â”‚   â”‚
â”‚  â”‚  â€¢ Retention: 30 jours                         â”‚   â”‚
â”‚  â”‚  â€¢ Location: /data/backups                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Resources:                                             â”‚
â”‚  â€¢ CPU: 4 cores                                         â”‚
â”‚  â€¢ RAM: 8GB                                             â”‚
â”‚  â€¢ Disk: 200GB SSD                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ SERVEUR 2: API & Message Broker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR 2                            â”‚
â”‚                 Ubuntu 22.04 LTS                        â”‚
â”‚                 IP: 10.101.X.X2                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker Daemon                                 â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  API Instance 1 (Port 8001)          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: samaconso_api_1          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ FastAPI application               â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CPU: 2 cores                      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ RAM: 2GB                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Health: /health                   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Connects to:                      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    â†’ PostgreSQL (SERVEUR 1:6432)    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Redis (SERVEUR 3:6379)         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    â†’ RabbitMQ (localhost:5672)      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    â†’ MinIO (SERVEUR 1:9000)         â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  API Instance 2 (Port 8002)          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: samaconso_api_2          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Same configuration as Instance 1   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Provides redundancy                â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  RabbitMQ (Ports 5672, 15672)        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: samaconso_rabbitmq       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Message broker                     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Queues:                            â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - urgent (priority 9)              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - high_priority (priority 7)       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - normal (priority 5)              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - low_priority (priority 3)        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Management UI: 15672               â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Resources:                                             â”‚
â”‚  â€¢ CPU: 4 cores                                         â”‚
â”‚  â€¢ RAM: 8GB                                             â”‚
â”‚  â€¢ Disk: 100GB SSD                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ SERVEUR 3: Workers & Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR 3                            â”‚
â”‚                 Ubuntu 22.04 LTS                        â”‚
â”‚                 IP: 10.101.X.X3                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker Daemon                                 â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Redis (Port 6379)                   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: samaconso_redis          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Cache application                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ RÃ©sultats Celery                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Maxmemory: 4GB                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Policy: allkeys-lru               â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Persistence: AOF + RDB            â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Celery Worker 1                     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: celery_worker_1          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Queues: urgent, high_priority     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Concurrency: 4                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CPU: 2 cores                      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ RAM: 2GB                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Tasks:                            â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - send_urgent_notification        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - send_batch_notifications        â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Celery Worker 2                     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: celery_worker_2          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Queues: normal, low_priority      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Concurrency: 4                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CPU: 2 cores                      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ RAM: 2GB                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Tasks:                            â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - send_single_notification        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚    - send_broadcast_notifications    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Flower (Port 5555)                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Container: samaconso_flower         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Celery monitoring                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Web UI pour supervision           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Basic Auth: admin/admin           â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Resources:                                             â”‚
â”‚  â€¢ CPU: 4 cores                                         â”‚
â”‚  â€¢ RAM: 8GB                                             â”‚
â”‚  â€¢ Disk: 100GB SSD                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de DonnÃ©es Complet

### 1. RequÃªte API Standard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ (Mobile/Web)
â”‚ Mobile  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ HTTPS
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancer  â”‚ (10.101.X.X0)
â”‚      F5        â”‚ - Health check
â”‚                â”‚ - Session persistence (cookie)
â”‚                â”‚ - SSL termination
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚       â”‚
     â†“       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API 1  â”‚ â”‚ API 2  â”‚ (SERVEUR 2:8001/8002)
â”‚        â”‚ â”‚        â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚          â”‚
    â†“          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL     â”‚ (SERVEUR 1:6432 via PgBouncer)
â”‚   + MinIO        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis   â”‚ (SERVEUR 3:6379 - Cache)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Flux Notification Push

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API     â”‚ (SERVEUR 2)
â”‚Instance â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. CrÃ©er tÃ¢che Celery
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ    â”‚ (SERVEUR 2:5672)
â”‚  Queue:      â”‚ - urgent
â”‚              â”‚ - high_priority
â”‚              â”‚ - normal
â”‚              â”‚ - low_priority
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Distribuer tÃ¢ches
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Workers   â”‚ (SERVEUR 3)
â”‚  Worker 1:       â”‚ urgent, high_priority
â”‚  Worker 2:       â”‚ normal, low_priority
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Traiter tÃ¢ches
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firebase    â”‚ (Cloud - via Proxy Senelec)
â”‚    FCM       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Envoyer notification
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Device     â”‚ (Android/iOS)
â”‚   Utilisateurâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Flux Lecture Consommation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ GET /api/consumption/{user_id}
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    API     â”‚ (SERVEUR 2)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Check cache
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Redis     â”‚ (SERVEUR 3)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Si cache miss
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL     â”‚ (SERVEUR 1 via PgBouncer)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Query data
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQL Server SIC  â”‚ (10.101.2.87)
â”‚   (via proxy)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Aggregate data
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis   â”‚ (SERVEUR 3 - Store in cache)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Return response
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Matrice de ConnectivitÃ© RÃ©seau

```
Source          â†’ Destination      Port    Protocol  Firewall
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Load Balancer   â†’ SERVEUR 2 API1  8001    HTTP      âœ… Allow
Load Balancer   â†’ SERVEUR 2 API2  8002    HTTP      âœ… Allow

SERVEUR 2 API   â†’ SERVEUR 1 PgB   6432    TCP       âœ… Allow
SERVEUR 2 API   â†’ SERVEUR 1 MinIO 9000    HTTP      âœ… Allow
SERVEUR 2 API   â†’ SERVEUR 3 Redis 6379    TCP       âœ… Allow
SERVEUR 2 API   â†’ SQL SIC         1433    TCP       âœ… Allow
SERVEUR 2 API   â†’ SQL Postpaid    1433    TCP       âœ… Allow

SERVEUR 3 Work  â†’ SERVEUR 2 RMQ   5672    AMQP      âœ… Allow
SERVEUR 3 Work  â†’ SERVEUR 1 PgB   6432    TCP       âœ… Allow
SERVEUR 3 Work  â†’ Firebase        443     HTTPS     âœ… Proxy

Admin Network   â†’ SERVEUR 1 MinIO 9001    HTTPS     âœ… Allow
Admin Network   â†’ SERVEUR 2 RMQ   15672   HTTP      âœ… Allow
Admin Network   â†’ SERVEUR 3 Flow  5555    HTTP      âœ… Allow
Admin Network   â†’ All Servers SSH 22      SSH       âœ… Allow

Internet        â†’ All Others      *       *         âŒ Deny
```

---

## ğŸ“Š RÃ©partition des Ressources

### CPU Allocation

```
SERVEUR 1 (4 cores):
â”œâ”€â”€ PostgreSQL:     2 cores (50%)
â”œâ”€â”€ PgBouncer:      0.5 cores (12%)
â”œâ”€â”€ MinIO:          1 core (25%)
â””â”€â”€ SystÃ¨me:        0.5 cores (13%)

SERVEUR 2 (4 cores):
â”œâ”€â”€ API Instance 1: 2 cores (50%)
â”œâ”€â”€ API Instance 2: 2 cores (50%)
â””â”€â”€ RabbitMQ:       Shared

SERVEUR 3 (4 cores):
â”œâ”€â”€ Worker 1:       2 cores (50%)
â”œâ”€â”€ Worker 2:       2 cores (50%)
â”œâ”€â”€ Redis:          Shared
â””â”€â”€ Flower:         Shared
```

### RAM Allocation

```
SERVEUR 1 (8GB):
â”œâ”€â”€ PostgreSQL:     4GB (shared_buffers: 2GB)
â”œâ”€â”€ PgBouncer:      512MB
â”œâ”€â”€ MinIO:          2GB
â””â”€â”€ SystÃ¨me:        1.5GB

SERVEUR 2 (8GB):
â”œâ”€â”€ API Instance 1: 2GB
â”œâ”€â”€ API Instance 2: 2GB
â”œâ”€â”€ RabbitMQ:       2GB
â””â”€â”€ SystÃ¨me:        2GB

SERVEUR 3 (8GB):
â”œâ”€â”€ Worker 1:       2GB
â”œâ”€â”€ Worker 2:       2GB
â”œâ”€â”€ Redis:          4GB (maxmemory)
â””â”€â”€ SystÃ¨me:        Reserved
```

### Disk Usage Estimation

```
SERVEUR 1 (200GB SSD):
â”œâ”€â”€ PostgreSQL data:     100GB (50%)
â”œâ”€â”€ MinIO storage:       70GB (35%)
â”œâ”€â”€ Backups:             20GB (10%)
â””â”€â”€ SystÃ¨me:             10GB (5%)

SERVEUR 2 (100GB SSD):
â”œâ”€â”€ Docker images:       20GB (20%)
â”œâ”€â”€ Logs:                40GB (40%)
â”œâ”€â”€ RabbitMQ data:       20GB (20%)
â””â”€â”€ SystÃ¨me:             20GB (20%)

SERVEUR 3 (100GB SSD):
â”œâ”€â”€ Docker images:       20GB (20%)
â”œâ”€â”€ Logs:                30GB (30%)
â”œâ”€â”€ Redis persistence:   30GB (30%)
â””â”€â”€ SystÃ¨me:             20GB (20%)
```

---

## ğŸ”„ ScalabilitÃ©

### Scaling Horizontal (Ajouter des serveurs)

```
CapacitÃ© Actuelle:
â”œâ”€â”€ API: 2 instances    â†’ 10,000 users/concurrents
â”œâ”€â”€ Workers: 2 workers  â†’ 1000 notif/min
â””â”€â”€ Database: 1 master  â†’ 200 connections

Scaling Phase 1 (+50% capacitÃ©):
â”œâ”€â”€ API: 3 instances    â†’ 15,000 users
â”œâ”€â”€ Workers: 3 workers  â†’ 1500 notif/min
â””â”€â”€ Database: 1 master  â†’ 200 connections

Scaling Phase 2 (+100% capacitÃ©):
â”œâ”€â”€ API: 4 instances    â†’ 20,000 users
â”œâ”€â”€ Workers: 4 workers  â†’ 2000 notif/min
â””â”€â”€ Database: 1 master + 1 replica â†’ 400 connections
```

### Scaling Vertical (Augmenter resources)

```
Niveau 1 (Actuel):
â”œâ”€â”€ 4 cores, 8GB RAM per server
â””â”€â”€ Capacity: 1M users

Niveau 2 (Scaling):
â”œâ”€â”€ 8 cores, 16GB RAM per server
â””â”€â”€ Capacity: 2M users

Niveau 3 (Max):
â”œâ”€â”€ 16 cores, 32GB RAM per server
â””â”€â”€ Capacity: 5M users
```

---

## ğŸš€ Performance Benchmarks

### Latence Attendue

```
Endpoint                  P50      P95      P99
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /health              10ms     20ms     30ms
POST /api/login          100ms    200ms    500ms
GET /api/consumption     150ms    300ms    800ms
POST /notifications      50ms     100ms    200ms
GET /api/users/{id}      80ms     150ms    300ms
```

### Throughput

```
Component            Requests/sec    Connections
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API (2 instances)    2,000          10,000
PostgreSQL           5,000 queries  200 conn
Redis                50,000 ops     Unlimited
RabbitMQ             1,000 msg/s    1,000 conn
Workers              100 tasks/min  N/A
```

---

**Version**: 1.0
**Date**: 2025-11-12
**ComplÃ©ment de**: [PRODUCTION_README.md](PRODUCTION_README.md)
